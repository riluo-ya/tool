<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ–°æ‹Ÿæ€Â·å¯¼èˆªç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans SC', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #e0e5ec; min-height: 100vh; }
        .neu-flat {
            background: #e0e5ec;
            box-shadow: 12px 12px 24px rgb(163,177,198,0.6), -12px -12px 24px rgba(255,255,255, 0.7);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .neu-pressed {
            background: #e0e5ec;
            box-shadow: inset 6px 6px 12px 0 rgba(163,177,198, 0.7), inset -6px -6px 12px 0 rgba(255,255,255, 0.9);
            border-radius: 16px;
        }
        .neu-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        .neu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 14px 14px 28px rgb(163,177,198,0.6), -14px -14px 28px rgba(255,255,255, 0.8);
        }
        .neu-btn:active {
            transform: scale(0.98);
            box-shadow: inset 4px 4px 8px 0 rgba(163,177,198, 0.6), inset -4px -4px 8px 0 rgba(255,255,255, 0.8);
        }
        .neu-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .neu-input:focus {
            outline: none;
            box-shadow: inset 8px 8px 16px 0 rgba(163,177,198, 0.7), inset -8px -8px 16px 0 rgba(255,255,255, 0.9);
        }
        .neu-tag {
            background: #e0e5ec;
            box-shadow: 3px 3px 6px #a3b1c6, -3px -3px 6px #ffffff;
            transition: all 0.2s ease;
        }
        .neu-tag.active {
            box-shadow: inset 3px 3px 6px rgba(163,177,198,0.5), inset -3px -3px 6px rgba(255,255,255,0.5);
            color: #667eea;
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            overflow-x: auto;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-custom {
            animation: spin 1s linear infinite;
        }
        .card-enter {
            animation: slideUp 0.5s ease-out forwards;
            opacity: 0;
        }
        .hidden-section { display: none; }
        .visible-section { display: block; animation: slideUp 0.5s ease-out; }
        .tab-btn { position: relative; }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 20%;
            right: 20%;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }
        .fetched-card { transition: all 0.3s ease; }
        .fetched-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="antialiased p-4 sm:p-6 lg:p-8">
    <div class="max-w-6xl mx-auto">
        <header class="neu-flat p-6 sm:p-8 mb-8 text-center card-enter">
            <h1 class="text-2xl sm:text-3xl font-bold mb-2 gradient-text">æ–°æ‹Ÿæ€Â·å¯¼èˆªç®¡ç†</h1>
            <p class="text-gray-500 text-sm">è‡ªåŠ¨åŒæ­¥å¯¼èˆªç«™æ•°æ® Â· å¯è§†åŒ–ç¼–è¾‘</p>
        </header>

        <div id="loginSection" class="visible-section">
            <div class="neu-flat p-6 sm:p-8 mb-6 card-enter" style="animation-delay: 0.1s">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 mx-auto rounded-full neu-flat flex items-center justify-center mb-4">
                        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2">è¯·è¾“å…¥ç®¡ç†å¯†ç </h2>
                    <p class="text-gray-500 text-sm">æ­¤å·¥å…·ä»…é™æˆæƒç”¨æˆ·ä½¿ç”¨</p>
                </div>
                <div class="max-w-sm mx-auto">
                    <input type="password" id="passwordInput" placeholder="è¾“å…¥å¯†ç ..." 
                           class="neu-input neu-pressed w-full px-5 py-4 text-base text-gray-700 placeholder-gray-400 transition-all duration-300 rounded-2xl text-center mb-4"
                           autocomplete="off">
                    <button onclick="verifyPassword()" id="loginBtn" class="neu-btn neu-flat w-full py-4 rounded-xl font-medium text-gray-700 hover:text-blue-600 transition-colors">
                        éªŒè¯å¹¶è¿›å…¥
                    </button>
                    <p id="errorMsg" class="text-red-500 text-sm text-center mt-3 hidden">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</p>
                </div>
            </div>
        </div>

        <div id="mainSection" class="hidden-section">
            <!-- æ•°æ®åŒæ­¥æ  - ç®€åŒ–ç‰ˆï¼Œåªæœ‰åˆ·æ–°æŒ‰é’® -->
            <div class="neu-flat p-4 mb-6 flex items-center justify-between card-enter">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl neu-flat flex items-center justify-center bg-blue-100">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800">æ•°æ®åŒæ­¥</h3>
                        <p class="text-xs text-gray-500">æ¥æº: riluo-ya.github.io/tool/</p>
                    </div>
                </div>
                <button onclick="refreshData()" id="refreshBtn" class="neu-btn neu-flat px-4 py-2 rounded-xl text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center gap-2">
                    <svg id="refreshIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <span>åˆ·æ–°æ•°æ®</span>
                </button>
            </div>

            <!-- çˆ¬å–çŠ¶æ€æ˜¾ç¤º -->
            <div id="fetchStatus" class="hidden-section mb-6">
                <div class="neu-flat p-4 flex items-center gap-3">
                    <div id="statusIcon" class="w-8 h-8 rounded-full border-2 border-blue-500 border-t-transparent animate-spin-custom"></div>
                    <span class="text-gray-600 text-sm" id="fetchStatusText">æ­£åœ¨çˆ¬å–æ•°æ®...</span>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
            <div class="neu-flat p-2 mb-6 flex gap-2 overflow-x-auto card-enter" style="animation-delay: 0.1s">
                <button onclick="switchTab('existing')" id="tab-existing" class="tab-btn active flex-1 py-3 px-4 rounded-xl text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors whitespace-nowrap">
                    ğŸ“‹ ç°æœ‰ç½‘ç«™
                </button>
                <button onclick="switchTab('add')" id="tab-add" class="tab-btn flex-1 py-3 px-4 rounded-xl text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors whitespace-nowrap">
                    â• æ·»åŠ æ–°ç½‘ç«™
                </button>
                <button onclick="switchTab('category')" id="tab-category" class="tab-btn flex-1 py-3 px-4 rounded-xl text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors whitespace-nowrap">
                    ğŸ·ï¸ ç®¡ç†åˆ†ç±»
                </button>
            </div>

            <div id="existingTab" class="visible-section">
                <div class="neu-flat p-6 sm:p-8 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl neu-flat flex items-center justify-center">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">ç°æœ‰ç½‘ç«™åˆ—è¡¨</h2>
                                <p class="text-xs text-gray-500" id="siteCount">æ­£åœ¨åŠ è½½æ•°æ®...</p>
                            </div>
                        </div>
                        <select id="filterCategory" onchange="filterSites()" class="neu-input neu-pressed px-3 py-2 text-sm rounded-xl">
                            <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                        </select>
                    </div>
                    <div id="sitesGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="text-center py-12 text-gray-400 col-span-full">
                            <div class="w-16 h-16 mx-auto mb-4 rounded-full border-4 border-blue-200 border-t-blue-500 animate-spin-custom"></div>
                            <p>æ­£åœ¨è‡ªåŠ¨è·å–æ•°æ®...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="addTab" class="hidden-section">
                <div class="neu-flat p-6 sm:p-8 mb-6 card-enter">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-xl neu-flat flex items-center justify-center">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">æ·»åŠ æ–°ç½‘ç«™</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">ç½‘ç«™åç§°</label>
                            <input type="text" id="siteName" placeholder="ä¾‹å¦‚ï¼šPhigros æŸ¥åˆ†å™¨" 
                                   class="neu-input neu-pressed w-full px-4 py-3 text-sm text-gray-700 placeholder-gray-400 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">æœç´¢å…³é”®è¯ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰</label>
                            <input type="text" id="searchKeywords" placeholder="ä¾‹å¦‚ï¼šphigros phib19 lilith æŸ¥åˆ†" 
                                   class="neu-input neu-pressed w-full px-4 py-3 text-sm text-gray-700 placeholder-gray-400 rounded-xl">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-600 mb-2">åˆ†ç±» <span class="text-red-400">*</span></label>
                        <div class="flex flex-wrap gap-2" id="newSiteCategoryContainer">
                            <span class="text-gray-400 text-sm italic">ç­‰å¾…æ•°æ®åŒæ­¥...</span>
                        </div>
                        <input type="hidden" id="selectedCategory" value="">
                        <p id="categoryHint" class="text-xs text-gray-400 mt-2 hidden">è¯·å…ˆç‚¹å‡»"åˆ·æ–°æ•°æ®"è·å–åˆ†ç±»åˆ—è¡¨</p>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-600 mb-2">å›¾æ ‡ï¼ˆEmojiï¼‰</label>
                        <input type="text" id="siteIcon" placeholder="ä¾‹å¦‚ï¼šğŸµ ğŸŒ¸ ğŸ”Œ â›ï¸ ğŸ“" 
                               class="neu-input neu-pressed w-full px-4 py-3 text-sm text-gray-700 placeholder-gray-400 rounded-xl">
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-600 mb-2">æè¿°</label>
                        <textarea id="siteDesc" rows="3" placeholder="ç½‘ç«™åŠŸèƒ½æè¿°..." 
                                  class="neu-input neu-pressed w-full px-4 py-3 text-sm text-gray-700 placeholder-gray-400 rounded-xl resize-none"></textarea>
                    </div>

                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-sm font-medium text-gray-600">é“¾æ¥åˆ—è¡¨</label>
                            <button onclick="addLinkField()" class="neu-tag px-3 py-1 rounded-lg text-xs font-medium text-blue-600 hover:text-blue-700">
                                + æ·»åŠ é“¾æ¥
                            </button>
                        </div>
                        <div id="linksContainer" class="space-y-3">
                            <div class="link-item grid grid-cols-1 md:grid-cols-3 gap-2">
                                <input type="text" placeholder="é“¾æ¥æ–‡æœ¬" class="link-text neu-input neu-pressed px-4 py-2 text-sm rounded-xl">
                                <div class="flex gap-2 md:col-span-2">
                                    <input type="text" placeholder="é“¾æ¥URL" class="link-url neu-input neu-pressed px-4 py-2 text-sm rounded-xl flex-1">
                                    <button onclick="this.closest('.link-item').remove()" class="neu-tag w-10 h-10 rounded-xl flex items-center justify-center text-red-500 hover:text-red-600 shrink-0">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button onclick="generateSiteCode()" class="neu-btn neu-flat w-full py-4 rounded-xl font-medium text-gray-700 hover:text-green-600 transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                        </svg>
                        ç”Ÿæˆ HTML ä»£ç 
                    </button>
                </div>
            </div>

            <div id="categoryTab" class="hidden-section">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="neu-flat p-6 sm:p-8 card-enter">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-xl neu-flat flex items-center justify-center">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                                </svg>
                            </div>
                            <h2 class="text-xl font-bold text-gray-800">ç°æœ‰åˆ†ç±»</h2>
                        </div>
                        <div id="categoryList" class="space-y-3">
                            <p class="text-gray-400 text-center py-8">æ­£åœ¨åŠ è½½...</p>
                        </div>
                    </div>

                    <div class="neu-flat p-6 sm:p-8 card-enter" style="animation-delay: 0.1s">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-xl neu-flat flex items-center justify-center">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                            </div>
                            <h2 class="text-xl font-bold text-gray-800">æ·»åŠ æ–°åˆ†ç±»</h2>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-600 mb-2">åˆ†ç±»æ ‡è¯†ï¼ˆdata-filterï¼‰</label>
                            <input type="text" id="newCategoryId" placeholder="ä¾‹å¦‚ï¼šdesignã€photoï¼ˆè‹±æ–‡ï¼‰" 
                                   class="neu-input neu-pressed w-full px-4 py-3 text-sm text-gray-700 placeholder-gray-400 rounded-xl">
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-600 mb-2">æ˜¾ç¤ºåç§°</label>
                            <input type="text" id="newCategoryLabel" placeholder="ä¾‹å¦‚ï¼šğŸ¨ è®¾è®¡èµ„æº" 
                                   class="neu-input neu-pressed w-full px-4 py-3 text-sm text-gray-700 placeholder-gray-400 rounded-xl">
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-600 mb-2">ä¸»é¢˜é¢œè‰²</label>
                            <div class="flex flex-wrap gap-3">
                                <button onclick="selectColor('purple')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-transparent hover:scale-110 transition-transform" data-color="purple" style="background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);"></button>
                                <button onclick="selectColor('green')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-transparent hover:scale-110 transition-transform" data-color="green" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);"></button>
                                <button onclick="selectColor('orange')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-transparent hover:scale-110 transition-transform" data-color="orange" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);"></button>
                                <button onclick="selectColor('red')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-transparent hover:scale-110 transition-transform" data-color="red" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"></button>
                                <button onclick="selectColor('blue')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-white ring-2 ring-blue-400 hover:scale-110 transition-transform" data-color="blue" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);"></button>
                                <button onclick="selectColor('pink')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-transparent hover:scale-110 transition-transform" data-color="pink" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);"></button>
                                <button onclick="selectColor('cyan')" class="color-btn w-10 h-10 rounded-full neu-flat border-2 border-transparent hover:scale-110 transition-transform" data-color="cyan" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);"></button>
                            </div>
                            <input type="hidden" id="selectedColor" value="blue">
                        </div>

                        <button onclick="generateCategoryCode()" class="neu-btn neu-flat w-full py-3 rounded-xl font-medium text-gray-700 hover:text-purple-600 transition-colors">
                            ç”Ÿæˆåˆ†ç±»ä»£ç 
                        </button>
                    </div>
                </div>
            </div>

            <div id="codeSection" class="neu-flat p-6 sm:p-8 mb-6 hidden-section">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800" id="codeTitle">ç”Ÿæˆçš„ä»£ç </h3>
                    <button onclick="copyCode()" class="neu-tag px-4 py-2 rounded-lg text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                        å¤åˆ¶
                    </button>
                </div>
                <div class="neu-pressed rounded-xl p-4 overflow-hidden">
                    <pre class="code-block whitespace-pre-wrap break-all" id="generatedCode"></pre>
                </div>
                <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                    <p class="text-blue-800 text-sm font-medium mb-2">ğŸ’¡ æç¤º</p>
                    <p class="text-blue-700 text-xs leading-relaxed" id="codeTips">å°†ä»£ç å¤åˆ¶åˆ°å¯¹åº”ä½ç½®å³å¯</p>
                </div>
            </div>

            <div class="text-center">
                <button onclick="logout()" class="neu-btn neu-flat px-8 py-3 rounded-xl text-sm font-medium text-gray-500 hover:text-red-500 transition-colors">
                    é€€å‡ºç®¡ç†
                </button>
            </div>
        </div>
    </div>

    <script>
        const CORRECT_HASH = 'b7dbf8ff4e5ca80fc5964ab6f82ce18663bac9f8a0ea43275ae13de1cc7761d3';
        const TARGET_URL = 'https://riluo-ya.github.io/tool/';
        
        let isAuthenticated = false;
        let currentTab = 'existing';
        let fetchedData = { categories: [], sites: [] };
        let isFirstLoad = true;

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function verifyPassword() {
            const input = document.getElementById('passwordInput');
            const btn = document.getElementById('loginBtn');
            const errorMsg = document.getElementById('errorMsg');
            
            const password = input.value.trim();
            if (!password) {
                input.classList.add('shake');
                setTimeout(() => input.classList.remove('shake'), 400);
                return;
            }

            btn.disabled = true;
            btn.textContent = 'éªŒè¯ä¸­...';

            try {
                const hash = await sha256(password);
                if (hash === CORRECT_HASH) {
                    isAuthenticated = true;
                    document.getElementById('loginSection').classList.remove('visible-section');
                    document.getElementById('loginSection').classList.add('hidden-section');
                    document.getElementById('mainSection').classList.remove('hidden-section');
                    document.getElementById('mainSection').classList.add('visible-section');
                    if (window.navigator && window.navigator.vibrate) window.navigator.vibrate(50);
                    
                    // è¿›å…¥åè‡ªåŠ¨çˆ¬å–
                    setTimeout(() => fetchRemoteData(true), 500);
                } else {
                    errorMsg.classList.remove('hidden');
                    input.classList.add('shake');
                    setTimeout(() => {
                        input.classList.remove('shake');
                        input.value = '';
                        input.focus();
                    }, 400);
                }
            } catch (e) {
                alert('éªŒè¯å¤±è´¥');
            } finally {
                btn.disabled = false;
                btn.textContent = 'éªŒè¯å¹¶è¿›å…¥';
            }
        }

        document.getElementById('passwordInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') verifyPassword();
        });

        // åˆ·æ–°æ•°æ®æŒ‰é’®
        function refreshData() {
            fetchRemoteData(false);
        }

        async function fetchRemoteData(isAuto = false) {
            const btn = document.getElementById('refreshBtn');
            const status = document.getElementById('fetchStatus');
            const statusText = document.getElementById('fetchStatusText');
            const statusIcon = document.getElementById('statusIcon');
            const refreshIcon = document.getElementById('refreshIcon');
            
            btn.disabled = true;
            refreshIcon.classList.add('animate-spin-custom');
            status.classList.remove('hidden-section');
            status.classList.add('visible-section');
            statusIcon.className = 'w-8 h-8 rounded-full border-2 border-blue-500 border-t-transparent animate-spin-custom';
            
            if (isAuto && isFirstLoad) {
                statusText.textContent = 'é¦–æ¬¡åŠ è½½ï¼Œæ­£åœ¨è·å–æ•°æ®...';
            } else {
                statusText.textContent = 'æ­£åœ¨åˆ·æ–°æ•°æ®...';
            }
            
            try {
                const proxyUrls = [
                    `https://api.allorigins.win/raw?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://corsproxy.io/?${encodeURIComponent(TARGET_URL)}`,
                    TARGET_URL
                ];
                
                let html = null;
                let success = false;
                
                for (const fetchUrl of proxyUrls) {
                    try {
                        const response = await fetch(fetchUrl, { 
                            method: 'GET',
                            headers: { 'Accept': 'text/html' }
                        });
                        if (response.ok) {
                            html = await response.text();
                            success = true;
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }
                
                if (!success || !html) {
                    throw new Error('æ— æ³•è·å–é¡µé¢å†…å®¹ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                }
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // æå–åˆ†ç±» - è¿‡æ»¤æ‰"å…¨éƒ¨"
                const categories = [];
                const categoryBtns = doc.querySelectorAll('[data-filter]');
                categoryBtns.forEach(btn => {
                    const id = btn.getAttribute('data-filter');
                    const label = btn.textContent.trim();
                    // è·³è¿‡"å…¨éƒ¨"åˆ†ç±»
                    if (id === 'all' || id === '*' || label.includes('å…¨éƒ¨')) return;
                    if (id && label && !categories.find(c => c.id === id)) {
                        const colorMatch = btn.className.match(/text-(\w+)-600/);
                        const color = colorMatch ? colorMatch[1] : 'blue';
                        categories.push({ id, label, color });
                    }
                });
                
                // æå–ç½‘ç«™
                const sites = [];
                const cards = doc.querySelectorAll('.site-card, [data-category]');
                cards.forEach(card => {
                    const category = card.getAttribute('data-category');
                    // è·³è¿‡"å…¨éƒ¨"åˆ†ç±»çš„ç½‘ç«™
                    if (category === 'all' || category === '*') return;
                    
                    const name = card.getAttribute('data-name') || '';
                    const titleEl = card.querySelector('h3');
                    const title = titleEl ? titleEl.textContent.trim() : '';
                    const descEl = card.querySelector('p');
                    const desc = descEl ? descEl.textContent.trim() : '';
                    const iconEl = card.querySelector('.icon-wrapper, .text-2xl, .text-xl');
                    const icon = iconEl ? iconEl.textContent.trim().charAt(0) : 'âœ¨';
                    
                    const links = [];
                    const linkEls = card.querySelectorAll('a[href]');
                    linkEls.forEach(a => {
                        links.push({
                            text: a.textContent.trim(),
                            url: a.getAttribute('href')
                        });
                    });
                    
                    if (title && category) {
                        sites.push({ category, name, title, desc, icon, links });
                    }
                });
                
                fetchedData = { categories, sites };
                isFirstLoad = false;
                
                updateCategoryUI();
                updateSitesUI();
                updateCategoryFilter();
                
                statusText.textContent = `æˆåŠŸï¼å…± ${categories.length} ä¸ªåˆ†ç±»ï¼Œ${sites.length} ä¸ªç½‘ç«™`;
                statusIcon.className = 'w-8 h-8 rounded-full bg-green-500 flex items-center justify-center';
                statusIcon.innerHTML = '<svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                
                if (window.navigator && window.navigator.vibrate) window.navigator.vibrate([50, 50, 50]);
                
            } catch (error) {
                console.error(error);
                statusText.textContent = 'å¤±è´¥ï¼š' + error.message;
                statusIcon.className = 'w-8 h-8 rounded-full bg-red-500 flex items-center justify-center';
                statusIcon.innerHTML = '<svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                
                if (isFirstLoad) {
                    document.getElementById('sitesGrid').innerHTML = `
                        <div class="text-center py-12 text-gray-400 col-span-full">
                            <p>è‡ªåŠ¨è·å–å¤±è´¥ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’"åˆ·æ–°æ•°æ®"é‡è¯•</p>
                            <p class="text-xs mt-2">${error.message}</p>
                        </div>
                    `;
                }
            } finally {
                btn.disabled = false;
                refreshIcon.classList.remove('animate-spin-custom');
                setTimeout(() => {
                    status.classList.add('hidden-section');
                    status.classList.remove('visible-section');
                    // æ¢å¤åŸå§‹å›¾æ ‡
                    setTimeout(() => {
                        statusIcon.className = 'w-8 h-8 rounded-full border-2 border-blue-500 border-t-transparent animate-spin-custom';
                        statusIcon.innerHTML = '';
                    }, 300);
                }, 2000);
            }
        }

        function updateCategoryUI() {
            const container = document.getElementById('categoryList');
            const newSiteContainer = document.getElementById('newSiteCategoryContainer');
            const categoryHint = document.getElementById('categoryHint');
            
            if (fetchedData.categories.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">æš‚æ— åˆ†ç±»æ•°æ®ï¼Œè¯·åˆ·æ–°</p>';
                newSiteContainer.innerHTML = '<span class="text-gray-400 text-sm italic">æš‚æ— å¯ç”¨åˆ†ç±»</span>';
                categoryHint.classList.remove('hidden');
                return;
            }
            
            // æ›´æ–°åˆ†ç±»åˆ—è¡¨
            container.innerHTML = fetchedData.categories.map(cat => `
                <div class="fetched-card neu-pressed p-4 rounded-xl flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full bg-${cat.color}-500"></div>
                        <div>
                            <p class="font-medium text-gray-800">${cat.label}</p>
                            <p class="text-xs text-gray-500">data-filter="${cat.id}"</p>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">${fetchedData.sites.filter(s => s.category === cat.id).length} ä¸ªç½‘ç«™</span>
                </div>
            `).join('');
            
            // æ›´æ–°æ·»åŠ ç½‘ç«™çš„åˆ†ç±»é€‰æ‹© - åªæ˜¾ç¤ºé"å…¨éƒ¨"çš„åˆ†ç±»
            newSiteContainer.innerHTML = fetchedData.categories.map((cat, index) => `
                <button onclick="selectCategory('${cat.id}')" 
                        class="neu-tag category-select-btn px-4 py-2 rounded-full text-sm font-medium text-gray-600 ${index === 0 ? 'active' : ''}" 
                        data-category="${cat.id}">
                    ${cat.label}
                </button>
            `).join('');
            
            categoryHint.classList.add('hidden');
            
            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª
            if (fetchedData.categories.length > 0) {
                document.getElementById('selectedCategory').value = fetchedData.categories[0].id;
            }
        }

        function updateSitesUI() {
            const container = document.getElementById('sitesGrid');
            const countEl = document.getElementById('siteCount');
            
            countEl.textContent = `å…± ${fetchedData.sites.length} ä¸ªç½‘ç«™ï¼Œ${fetchedData.categories.length} ä¸ªåˆ†ç±»`;
            
            if (fetchedData.sites.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-400 col-span-full"><p>æš‚æ— ç½‘ç«™æ•°æ®</p></div>';
                return;
            }
            
            renderSites(fetchedData.sites);
        }

        function renderSites(sites) {
            const container = document.getElementById('sitesGrid');
            
            container.innerHTML = sites.map((site, index) => {
                const cat = fetchedData.categories.find(c => c.id === site.category) || { color: 'blue', label: 'å…¶ä»–' };
                return `
                <div class="fetched-card neu-flat p-5 rounded-xl cursor-pointer" style="animation-delay: ${index * 0.05}s">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl neu-pressed flex items-center justify-center text-2xl">
                                ${site.icon}
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800">${site.title}</h3>
                                <span class="text-xs text-${cat.color}-600 bg-${cat.color}-50 px-2 py-0.5 rounded-full">${cat.label}</span>
                            </div>
                        </div>
                    </div>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">${site.desc}</p>
                    <div class="flex gap-2 flex-wrap">
                        ${site.links.slice(0, 2).map(link => `
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">${link.text}</span>
                        `).join('')}
                        ${site.links.length > 2 ? `<span class="text-xs text-gray-400">+${site.links.length - 2}</span>` : ''}
                    </div>
                </div>
            `}).join('');
        }

        function updateCategoryFilter() {
            const select = document.getElementById('filterCategory');
            // ä¿ç•™"å…¨éƒ¨"é€‰é¡¹ï¼Œä½†åªæ·»åŠ é"å…¨éƒ¨"çš„åˆ†ç±»
            select.innerHTML = '<option value="all">å…¨éƒ¨åˆ†ç±»</option>' + 
                fetchedData.categories.map(cat => `<option value="${cat.id}">${cat.label}</option>`).join('');
        }

        function filterSites() {
            const category = document.getElementById('filterCategory').value;
            if (category === 'all') {
                renderSites(fetchedData.sites);
            } else {
                renderSites(fetchedData.sites.filter(s => s.category === category));
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            
            ['existing', 'add', 'category'].forEach(t => {
                const el = document.getElementById(t + 'Tab');
                if (t === tab) {
                    el.classList.remove('hidden-section');
                    el.classList.add('visible-section');
                } else {
                    el.classList.remove('visible-section');
                    el.classList.add('hidden-section');
                }
            });
            
            document.getElementById('codeSection').classList.add('hidden-section');
        }

        function selectCategory(categoryId) {
            document.querySelectorAll('.category-select-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-category="${categoryId}"]`)?.classList.add('active');
            document.getElementById('selectedCategory').value = categoryId;
        }

        function selectColor(color) {
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-blue-400', 'border-white');
                btn.classList.add('border-transparent');
            });
            document.querySelector(`[data-color="${color}"]`)?.classList.remove('border-transparent');
            document.querySelector(`[data-color="${color}"]`)?.classList.add('ring-2', 'ring-blue-400', 'border-white');
            document.getElementById('selectedColor').value = color;
        }

        function addLinkField() {
            const container = document.getElementById('linksContainer');
            const div = document.createElement('div');
            div.className = 'link-item grid grid-cols-1 md:grid-cols-3 gap-2';
            div.innerHTML = `
                <input type="text" placeholder="é“¾æ¥æ–‡æœ¬" class="link-text neu-input neu-pressed px-4 py-2 text-sm rounded-xl">
                <div class="flex gap-2 md:col-span-2">
                    <input type="text" placeholder="é“¾æ¥URL" class="link-url neu-input neu-pressed px-4 py-2 text-sm rounded-xl flex-1">
                    <button onclick="this.closest('.link-item').remove()" class="neu-tag w-10 h-10 rounded-xl flex items-center justify-center text-red-500 hover:text-red-600 shrink-0">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            `;
            container.appendChild(div);
        }

        function generateSiteCode() {
            const name = document.getElementById('siteName').value.trim();
            const keywords = document.getElementById('searchKeywords').value.trim();
            const category = document.getElementById('selectedCategory').value;
            const icon = document.getElementById('siteIcon').value.trim() || 'âœ¨';
            const desc = document.getElementById('siteDesc').value.trim();

            if (!name || !desc || !category) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼ˆåˆ†ç±»ä¸ºå¿…å¡«ï¼‰');
                return;
            }

            const links = [];
            document.querySelectorAll('.link-item').forEach(item => {
                const text = item.querySelector('.link-text').value.trim();
                const url = item.querySelector('.link-url').value.trim();
                if (text && url) links.push({ text, url });
            });

            if (links.length === 0) {
                alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªé“¾æ¥');
                return;
            }

            const cat = fetchedData.categories.find(c => c.id === category) || { color: 'blue', label: 'å…¶ä»–' };
            const searchName = keywords || name.toLowerCase();

            const linksHtml = links.map(link => `
                    <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="neu-btn neu-flat py-2.5 px-3 rounded-xl flex items-center justify-between text-gray-700 active:text-${cat.color}-600 transition-colors text-sm">
                        <span class="font-medium truncate mr-2">${link.text}</span>
                        <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                    </a>`).join('');

            const html = `<!-- ${name} -->
<div class="site-card neu-flat p-5 sm:p-6 lg:p-8 neu-btn card-enter group" data-category="${category}" data-name="${searchName}">
    <div class="flex items-start justify-between mb-3 sm:mb-4">
        <div class="flex items-center gap-3 sm:gap-4">
            <div class="w-12 h-12 sm:w-14 sm:h-14 rounded-xl sm:rounded-2xl icon-wrapper flex items-center justify-center text-xl sm:text-2xl group-active:scale-95 transition-transform duration-200 shrink-0">
                ${icon}
            </div>
            <div class="min-w-0">
                <h3 class="text-lg sm:text-xl font-bold text-gray-800 truncate">${name}</h3>
                <span class="neu-tag px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs text-${cat.color}-600 mt-1 inline-block">${cat.label}</span>
            </div>
        </div>
        <div class="shrink-0 ml-2">
            <span class="w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full bg-green-400 shadow-[0_0_8px_rgba(74,222,128,0.6)] block"></span>
        </div>
    </div>
    <p class="text-gray-600 mb-4 text-xs sm:text-sm leading-relaxed line-clamp-2 sm:line-clamp-none">
        ${desc}
    </p>
    <div class="space-y-2 sm:space-y-3">${linksHtml}
    </div>
</div>`;

            showCode('ç”Ÿæˆçš„ç½‘ç«™å¡ç‰‡ä»£ç ', html, 'å°†ä»£ç å¤åˆ¶åˆ° index.html çš„ sitesGrid å®¹å™¨å†…');
        }

        function generateCategoryCode() {
            const id = document.getElementById('newCategoryId').value.trim().toLowerCase();
            const label = document.getElementById('newCategoryLabel').value.trim();
            const color = document.getElementById('selectedColor').value;

            if (!id || !label) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            if (!/^[a-z0-9_]+$/.test(id)) {
                alert('åˆ†ç±»æ ‡è¯†åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿');
                return;
            }

            const html = `<!-- ${label} ç­›é€‰æŒ‰é’® -->
<button onclick="filterSites('${id}')" class="neu-tag px-4 sm:px-6 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-medium text-gray-600 hover:text-${color}-600 transition-colors whitespace-nowrap shrink-0" data-filter="${id}">
    ${label}
</button>`;

            showCode('ç”Ÿæˆçš„åˆ†ç±»æŒ‰é’®ä»£ç ', html, 'å°†ä»£ç å¤åˆ¶åˆ° index.html çš„é¡¶éƒ¨åˆ†ç±»ç­›é€‰åŒºåŸŸ');
        }

        function showCode(title, code, tips) {
            document.getElementById('codeTitle').textContent = title;
            document.getElementById('generatedCode').textContent = code;
            document.getElementById('codeTips').textContent = tips;
            document.getElementById('codeSection').classList.remove('hidden-section');
            document.getElementById('codeSection').classList.add('visible-section');
            document.getElementById('codeSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelector('#codeSection button');
                const original = btn.innerHTML;
                btn.innerHTML = '<span class="text-green-600">å·²å¤åˆ¶!</span>';
                setTimeout(() => btn.innerHTML = original, 2000);
                if (window.navigator && window.navigator.vibrate) window.navigator.vibrate(20);
            });
        }

        function logout() {
            isAuthenticated = false;
            isFirstLoad = true;
            fetchedData = { categories: [], sites: [] };
            document.getElementById('mainSection').classList.remove('visible-section');
            document.getElementById('mainSection').classList.add('hidden-section');
            document.getElementById('loginSection').classList.remove('hidden-section');
            document.getElementById('loginSection').classList.add('visible-section');
            document.getElementById('passwordInput').value = '';
            
            // é‡ç½®UI
            document.getElementById('sitesGrid').innerHTML = `
                <div class="text-center py-12 text-gray-400 col-span-full">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full border-4 border-blue-200 border-t-blue-500 animate-spin-custom"></div>
                    <p>æ­£åœ¨è‡ªåŠ¨è·å–æ•°æ®...</p>
                </div>
            `;
            document.getElementById('siteCount').textContent = 'æ­£åœ¨åŠ è½½æ•°æ®...';
            document.getElementById('categoryList').innerHTML = '<p class="text-gray-400 text-center py-8">æ­£åœ¨åŠ è½½...</p>';
            document.getElementById('newSiteCategoryContainer').innerHTML = '<span class="text-gray-400 text-sm italic">ç­‰å¾…æ•°æ®åŒæ­¥...</span>';
            
            // é‡ç½®è¡¨å•
            document.getElementById('siteName').value = '';
            document.getElementById('searchKeywords').value = '';
            document.getElementById('siteIcon').value = '';
            document.getElementById('siteDesc').value = '';
            document.getElementById('linksContainer').innerHTML = `
                <div class="link-item grid grid-cols-1 md:grid-cols-3 gap-2">
                    <input type="text" placeholder="é“¾æ¥æ–‡æœ¬" class="link-text neu-input neu-pressed px-4 py-2 text-sm rounded-xl">
                    <div class="flex gap-2 md:col-span-2">
                        <input type="text" placeholder="é“¾æ¥URL" class="link-url neu-input neu-pressed px-4 py-2 text-sm rounded-xl flex-1">
                        <button onclick="this.closest('.link-item').remove()" class="neu-tag w-10 h-10 rounded-xl flex items-center justify-center text-red-500 hover:text-red-600 shrink-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('codeSection').classList.add('hidden-section');
            switchTab('existing');
        }

        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, { passive: false });
    </script>
</body>
</html>
